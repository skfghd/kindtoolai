# KINDTOOLAI 보안 가이드

## API 키 및 환경 변수 보안

### 중요 보안 원칙
1. **절대 클라이언트 사이드에 민감한 API 키를 노출하지 마세요**
2. **모든 민감한 정보는 서버 환경 변수로만 관리**
3. **에러 로그에서 민감한 정보 제거**
4. **클라이언트로 전송되는 모든 데이터 검증 및 정제**

### 환경 변수 분류

#### 서버 전용 (절대 클라이언트 노출 금지)
- `DATABASE_URL`: PostgreSQL 연결 문자열
- `SESSION_SECRET`: 세션 암호화 키
- `PGHOST`, `PGPORT`, `PGUSER`, `PGPASSWORD`, `PGDATABASE`: 데이터베이스 자격 증명

#### 클라이언트 허용 (공개 가능)
- `VITE_GA_MEASUREMENT_ID`: 구글 애널리틱스 측정 ID (공개 키)

### 보안 기능

#### 1. 환경 변수 검증
- 서버 시작 시 필수 환경 변수 존재 여부 확인
- DATABASE_URL 형식 유효성 검증
- 잘못된 설정 시 서버 시작 차단

#### 2. 응답 데이터 정제
- API 응답에서 민감한 필드 자동 제거
- 에러 로그에서 민감한 정보 마스킹
- 스택 트레이스는 개발 환경에서만 노출

#### 3. 보안 헤더
- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: DENY`
- `X-XSS-Protection: 1; mode=block`
- `Referrer-Policy: strict-origin-when-cross-origin`
- Content Security Policy 설정

#### 4. 에러 처리
- 프로덕션에서 스택 트레이스 숨김
- 민감한 정보가 포함된 에러 메시지 마스킹
- 데이터베이스 연결 문자열 자동 제거

### 개발 시 주의사항

1. **새로운 환경 변수 추가 시**:
   - `.env.example`에 예시 값 추가
   - 민감한 정보인지 공개 정보인지 분류
   - 클라이언트 노출이 필요하면 `VITE_` 접두사 사용

2. **API 개발 시**:
   - 모든 응답에 `sanitizeResponse()` 적용
   - 에러 로깅에 `sanitizeError()` 사용
   - 사용자 입력 데이터 검증

3. **데이터베이스 작업 시**:
   - ORM을 통한 안전한 쿼리 사용
   - 직접 SQL 작성 시 파라미터화된 쿼리 사용
   - 민감한 데이터 로깅 금지

### 보안 점검 리스트

- [ ] 모든 API 키가 서버 환경 변수로 관리되는가?
- [ ] 클라이언트 코드에 하드코딩된 비밀이 없는가?
- [ ] 에러 메시지에 민감한 정보가 포함되지 않는가?
- [ ] 로그에 개인정보나 인증 정보가 기록되지 않는가?
- [ ] 모든 사용자 입력이 검증되는가?
- [ ] 보안 헤더가 적절히 설정되어 있는가?

### 침해 대응

보안 문제 발견 시:
1. 즉시 관련 서비스 중단
2. 영향 범위 파악
3. 로그 분석 및 증거 보전
4. 보안 패치 적용
5. 사용자 알림 및 재시작